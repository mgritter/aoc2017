const INPUT : &str = "                                                                           |                                                                                                                             
     +-+         +---+   +---+   +-----------------------------------------|---+                                             +---+ +-------------------------------------+         +-------------------+ 
     | |         |   |   |   |   |                                         |   |                                             |   | |                                     |         |                   | 
 +-------------------|-------|-------------+                           +---|-------------------------------+                 |   +---------------------------------+     |         |                   | 
 |   | |         |   |   |   |   |         |                           |   |   |                           |                 |     |                               |     |         |                   | 
 |   | |         |   +---|---|---|---------|---------------------+     |   |   |                           |                 |     |   +---+                       |     |         |                   | 
 D   | |         |       |   |   |         |                     |     |   |   |                           |                 |     |   |   |                       |     |         |                   | 
 |   | |         |   +---|---+   |     +---|-------------+       |   +-+ +-|---|---------------------------|---------------------+ |   |   |                       |     |         |     +---------+   | 
 |   | |         |   |   |       |     |   |             |       |   |   | |   |                           |                 |   | |   |   |                       |     |         |     |         |   | 
 |   +-|---------|---|-------+   |     |   |             |       |   |   | |   |                           |                 |   | |   |   |                       |     |         |     |         |   | 
 |     |         |   |   |   |   |     |   |             |       |   |   | |   |                           |                 |   | |   |   |                       |     |         |     |         |   | 
 |   +-|---------|---------------|-----|---|---------------------|---|-----|---|--------------------F------------------------------+   +-----------------+         |     |         |     |         |   | 
 |   | |         |   |   |   |   |     |   |             |       |   |   | |   |                           |                 |   |         |             |         |     |         |     |         |   | 
 |   +-|-----+   |   | +-|---|---|-----|---|---------------------|-------|---------------------------------------------+     |   |         |             |         |     |         |   +-+ +---------+ | 
 |     |     |   |   | | |   |   |     |   |             |       |   |   | |   |                           |           |     |   |         |             |         |     |         |   |   |       | | | 
 |     |     |   |   | | |   |   |   +-|-------------------------|---------+   |       +-------------------|-----------|-----|---+       +-------------+ +-+       |     | +-----------+   |       | | | 
 |     |     |   |   | | |   |   |   | |   |             |       |   |   |     |       |                   |           |     |           | |           |   |       |     | |       |       |       | | | 
 |     |     |   |   | | |   +---|---|-----|-----------------------------+     |       |                   |           |     |           | |         +-|---|-+     |     | |       |       |       | | | 
 |     |     |   |   | | |       |   | |   |             |       |   |         |       |                   |           |     |           | |         | |   | |     |     | |       |       |       | | | 
 |     |     | +-------|-|-------|---|-|---|-------------|-----------|---------|---------------------------|---------+ |     +---+       | |         | |   | |     |     | |       |       |       | | | 
 |     |     | | |   | | |       |   | |   |             |       |   |         |       |                   |         | |         |       | |         | |   | |     |     | |       |       |       | | | 
 | +---------|-|-|-------+       |   | |   |             |   +-------|-----------------|-------------------|---------|-|-----------------|-|---------|-|---|-----------------+     |       |       | | | 
 | |   |     | | |   | |         |   | |   |             |   |   |   |         |       |                   |         | |         |       | |         | |   | |     |     | | |     |       |       | | | 
 | |   |     | | |   | +---------------|-----------------------+ |   |         |       |                   |         | |         |       | |         +-|---|-|-----------|-|-------|-------|---------|-+ 
 | |   |     | | |   |           |   | |   |             |   | | |   |         |       |                   |         | |         |       | |           |   | |     |     | | |     |       |       | |   
 | |   +-----+ | |   |     +-----------|-----------------|---|-|-----------------------|-----------------------------|-------------------|-------------|-------------------|-------|-----+ |       | +-+ 
 | |           | |   |     |     |   | |   |             |   | | |   |         |       |                   |         | |         |       | |           |   | |     |     | | |     |     | |       |   | 
 | |           | |   |   +-----------------------------------|-|---+ +-+ +-----|---------------------------|-----------|-----------------|-|-----------------------------|-|-|-----------|-|-------|-+ | 
 | |           | |   |   | |     |   | |   |             |   | | | |   | |     |       |                   |         | |         |       | |           |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     |   | |   |             |   | | | |   | |     |       |                   |         | |         |       | |       +-+ |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     |   | |   |             |   | | | |   | |     |       |                   |         | |         |       | |       | | |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     | +-|-------------------------|-|-------+     |       |                   |         | |         |       | |       | | |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     | | | |   |             |   | | | |   |       |       |                   |         | |         |       | |       | | |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     | | | |   |             |   | | | |   |       |       |                   |         | |         |       | +-------|-|-|-----------|-----|-+ |     |     | |       | | | 
 | |           | |   |   | |     | | | |   |             |   | | | |   |       |       |                   |         | |         |       |         | | |   | |     |     |   |     |     | |       | | | 
 | |   +-+     | |   |   +-----+ | +---|---|-----------------|-|---|---|-------|-------|-------------------|---------------------------+ |         | | |   | |     |     |   |     |     | |       | | | 
 | |   | |     | |   |     |   | |   | |   |             |   | | | |   |       |       |                   |         | |         |     | |         | | |   | |     |     |   |     |     | |       | | | 
 | |   | |     | |   |     |   | |   | |   |             |   | | | |   |       |       | +-----------------------+   | |     +---------|-----------|---------+     |     |   |     | +---|---------+ | | 
 | |   | |     | |   |     |   | |   | |   |             |   | | | |   |       |       | |                 |     |   | |     |   |     | |         | | |   J       |     |   |     | |   | |         | | 
 | +---|-|-----|-------+   |   | |   | |   |             | +-+ | | |   |       |       | |               +-|-----------|---------------|---------------|-----------------------------|-------+       | | 
 |     | |     | |   | |   |   | |   | |   |             | |   | | |   |       |       | |               | |     |   | |     |   |     | |         | | |   |       |     |   |     | |   | | |       | | 
 |     | |     | |   | |   |   | |   | |   |             | |   | | |   +-------|-------------------------+ |     |   | |     |   |     | |         | | |   |       |     |   | +---+ +-----|-|-----+ | | 
 |     | |     | |   | |   |   | |   | |   |             | |   | | |           |       | |                 |     |   | |     |   |     | |         | | |   |       |     |   | |         | | |     | | | 
 |     | |     | |   | |   |   | |   | |   |           +---|---+ +---------------------------------+       +-----|---|-------|---|-------------------|-|---|-----+ |     |   | |         | | |     | | | 
 |     | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         | | |   |     | |     |   | |         | | |     | | | 
 | +---|-------|-|---|-|-------|-------|---|-----------------------|-------------------|-----------|-----------------|-----------------|---------------|---|-----------------|-----------+ | |     | | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         | | |   |     | |     |   | |           | |     | | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         | +-------------|-----|-------------------|-----+ | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         |   |   |     | |     |   | |           | |       | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         |   |   |     | +-----|---|-|-----------|-+       | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         |   |   |     |       |   | |           |         | | 
 | |   | |     | |   +---------------|-|-------------------|-------------------|-------|-|-----------------------------------|---|---+ | |       +-|---------------------|---|-+           |         | | 
 | |   | |     | |     |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |   | | |       | |   |   |     |       |   |             |         | | 
 | |   | |     | |   +---+ |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |   | | |     +-|-|---|---|-----|-------|---|-------------+         | | 
 | |   | |     | |   | | | |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     |       |   |                       | | 
 | | +-|---------|---|---------+ |   | |   | +---------|-----------|-------------------|-|-----------------------|-----------|-------|-|-------|---|-------|-------+     |   |                       | | 
 | | | | |     | |   | | | |     |   | |   | |         | | |       |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     | |     |   |                       | | 
 | | | | |     | |   | | | |     +---------|-|-------------+       |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     | |     |   |                       | | 
 | | +---------|---------------------|-------------------|---------|-----------|-------|-|---------|-------------------|-----|---+   +---|-----|-|-|-+ +-------+ | |     |   |                       | | 
 | |   | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |         | |     | | | |     |   | | |     |   |                       | | 
 | | +---------|-|-------|-|-----------------|-----------|---------|---------------------------------------------|-----------|-----------|-----+ | | |   +-|-+ | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |         | |       | | |   | | | | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   +-------------|-----+ | | |   | | | | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   | |         | |     | | | |   | | | | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   | |         | |     | | | |   | | | | | |     |   |   +---------------+   | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   | |         | |     | | | |   | | | | | |     |   |   |               |   | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   +-|-----+   +-------|-|-|-|-----|-----|-------|---|---------------------+ | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |     |     |     | | | |   | | | | | |     |   |   |               | | | | 
 | | | | |     | |   | | | |         | |   | |         | |         |     +-------------|-|---------------------------|-|-----|-----|-----|-----+ | | |   | +-|-+ | |     |   |   |               | | | | 
 | | | | |     | |   | | | |         | |   | |         | |         |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |               | | | | 
 | | | | |     | |   | | | |         | |   | |         | | +-------|-------------------|-|-----------------------|---|-|-----|-------------------|-------|-------------------|---|---------------+ | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |   +---------------|-------------------------|---|-|-----|-----------|-------|-|-|-+ |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |   | |     |       | |         |             |   | |     |     |     |       | | | | |   |   | |     |   |   |                 | | | 
 | +-|---|-----------|-|---|-----------|---|-|-----------|-|-------|-----|-----|-------|-|---------|-----------------|-|-----|-----|-------------|-----------|---|-------|-+ |   |       +---------+ | | 
 |   | | |     | |   | | | |         | |   | |         | | |       |   | |     |       | |         |             |   | |     |     |     |       | | | | |   |   | |     | | |   |       |           | | 
 |   | | |     | |   | | | |         | |   | |   +-----|-------------------------------|-|---------+             |   | |     |     |     |       | | | | |   |   | |     | | |   |       |           | | 
 |   | | |     | |   | | | |         | |   | |   |     | | |       |   | |     |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |           | | 
 |   | | |     | |   | | | |         | |   | |   |     | | |       |   | +-------------|-------------------------|-----|-----|-----|---------------|-|-|-|---|---|-------|---|---|-----------+       | | 
 |   | | |     | |   | | | |         | |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |       | | 
 |   +-|-------|-|---|---|-----------+ |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |       | | 
 |     | |     | |   | | | |           |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |       | | 
 |     | |     | |   | | | |     +-----|---|-----------|-|---------|---|-------|---------------------------------|-----|-------------------------|-|-|-|-|---|---|---------|-----|-----------|-----+ | | 
 |     | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |     | | | 
 +-----|-|-----|-----------------------|-----|---|-----|-|-|-------------------|-------|-------------------------|---|-|-----------|-----|---+   | | | | |   |   | |     | | |   |       |   |     | | | 
       | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |   |   | | | | |   |   | |     | | |   |       |   |     | | | 
       | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |             +---------|---|-|-+   |     |     |   |   | | | | |   |   | |     | | |   |       |   |     | | | 
       | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |             |         |   | | |   |     |     |   |   | | | | |   |   | |     | | |   |       |   |     | | | 
     +---|-----------|-|-|-------|---+ |   | |   +-------|-+       |   |       |       | |             |         |   | | |   |     |     |   | +---|-|---|---|---|-----+ | | |   |       |   |     | | | 
     | | |     | |   | | | |     |   | |   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
     | | |     | |   | | | |     |   | |   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
     | | |     | |   | | | |     |   | |   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
 +---+ | |     | |   | | | |     |   +-+   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
 |     | |     | |   | | | |     |         | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
 | +---+ |   +-|-----|---|-|-----|---------------------|-|---------------------|---------|-----------------------|---|-------|-----------|-------|-|---------|-----------|-------|-------+   |     | | | 
 | |     |   | | |   | | | |     |         | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |           |     | | | 
 | | +---|-----|-|-------|-|---------------|-|-----------|---------+   |       +-------|-|-------------|-------------|-------|-----|-----|-+ | | | | | | |   |   | |   | | | |   |           |     | | | 
 | | |   |   | | |   | | | |     |         | |         | |             |               | |             |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |           |     | | | 
 | | +-----------|---+ | | |     |         | |         | |             |               | |           +-|---------|---|-------|-----|-----|-|---|-|-|---|-------------------|-|-------------+ |     | | | 
 | |     |   | | |     | | |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |         | |     | | | 
 | |     |   | | |     | | |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |         | |     | | | 
 | |     |   | | |     | | |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |         | |     | | | 
 | |     |   | | |     | +-------|---------|-------------|-----------------------------|---------------|---------------------|-----------|-|-|-|-|-|-|-----------|-|-----|-----------+     +-|-+   | | | 
 | |     |   | | |     |   |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |   |       | |   | | | 
 | |     |   | | |     |   | +---|---------------------|-|-------------|---------------+ +-----------|-----------|---|-|-|---|-----|---------|-|-|-|-|-|---------------+ | | |   |   |       | |   | | | 
 | |     |   | | |     |   | |   |         | |         | |             |                             | |         |   | | |   |     |     | | | | | | | | |   |   | |     | | |   |   |       | |   | | | 
 +-|-----|-----|-----------|---------------|-|---------|-|-------------|---------+       +-----------|-|---------|-----|-|---------|-----|-|---|-------|-|-----------------|-----|-----------|-|-+ | | | 
   |     |   | | |     |   | |   |         | |         | |             |         |       |           | |         |   | | |   |     |     | | | | | | | | |   |   | |     | | |   |   |       | | | | | | 
   |     |   | | |     |   | |   |   +-------|---------|-|-------------|-----------------------------|---+       |   +-|-|---------------|-----|-------|-|---+   | |     | | |   |   |       | | | | | | 
   |     |   | | |     |   | |   |   |     | |         | |             |         |       |           | | |       |     | |   |     |     | | | | | | | | |       | |     | | |   |   |       | | | | | | 
   |     | +-|-----+   |   | |   |   |     | |         | |         +---|-----------------------------|-----------------|-|---------------|---------------------+ | |     | | |   |   |       | | +-+ | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     | |   |     |     | | | | | | | | |     | | |     | | |   |   |       | |     | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     | |   |     |     | | | | | | | | |     | | |     | | |   |   |     +-----+   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     | |   |     |     | | | | | | | | |     | | |     | | |   |   |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     +-|---------|-----+ | | | | | | | |     | | |     | | |   |   |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |       |   |     |       | | | | | | | |     | | |     | | |   |   |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   +-----------+     |           | | |       |       |   |     |       | | | | | | | |     | | |     +-|-------+ |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |             | |     |           | | |       |       |   |     |       | | | | | | | |     | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   | +---+   |     | |         | |         |             | |     |           | | |       |       |   |     |       | | | | | | | |     | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | |         |             | |     |           | | |       |       |   |     |       | | | | | | | |     | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | +-------|-------------|--------------O----|-|---------------------------|-------|-|---|-|-|-------+ | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | |       |             | |     |           | | |       |       |   |     |       | | | | | | | |   | | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | |       |             | |     |           | +-|-+     |       |   |     |       | +-----|-------+ | | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | |       |             | |     |           |   | |     |       |   |     |       |   | | | | | | | | | | |       | |   | | |     | | | |   | | 
   |     | | | | +-|-----------------------|---------+ | | |       |             | |     |           |   | |     |       |   |     |       |   | | | | | | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |       | | | |       |             | |     |           |   | |     |       |   |     |       |   | | | | | | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |       +---|-------------------------------+           |   | +-----|-----------|-----------------|-----|-+ | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |                 |   |       |       |   |     |       |   | | | |   | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             +---|-------------------------------------|---|-----|---|---|-|-|-----------+   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | | | | |       |     | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | | | | |       |     | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | | | | |       |     | | |     | | | |   | | 
   |     | | | |   |   |   |     +-----------|---------|---|-------|-------------|---------------|---|---|-------|-------|---------|-----------|-|---|---|-|-|-+ | |       |     | +-|-----------|-+ | | 
   |     | | | |   |   |   |     |   |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | |   | |       |     |   |     | | | | | | | 
   |     | | | |   |   |   |     |   |     | |       +-|-------------------------|---------------|-------|---------------|-------+ |       |   | | | |   | | |   | |       |     |   |     | | | | | | | 
   |     | | | |   |   |   |     |   |     | |       | | | |       |             | |             |   |   |       |       |   |   | |       |   | | | |   | | |   | |       |     |   |     | | | | | | | 
   |     | | +---------|---------|---------|-+       | | | |       |           +-|-------------------|-----------|-------|-------|-|-------|---|---|-|---|---|---+ |       |     |   |     | | | | | | | 
   |     | |   |   |   |   U     |   |     |         | | | |       |           | | |             |   |   |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | | | | | 
 +-|---+ | | +---------|---|---------|-------+       | | | |       |           | | |   +-----------+ +---|---------------------------------|-----|-----------------|-----------------|-----------|-+ | | 
 | |   | | | | |   |   |   |     |   |     | |       | | | |       |           | | |   |         | |     |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | |   |   |   |     |   |     | |       | | +-|-------|-------------|-|---+         | |     |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | |   |   |   |     |   |     | |       | |   |       |           | | |             | |     |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | +-------------------|-----|-|-------|-|---|-------------------|-|---------------|-|---------------------|---|-------------+   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | | |   |   |     |   |     | |       | |   |       |           | | |             | |     |       |       |   |   | |           | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | | |   |   |     |   |     | |       | |   |       |           | | |   +-----------|---------+   |       |   |   | |           | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | | |   |   |     |   |     | |       | |   |       |           | | |   |         | |     |   |   |       |   |   | |           | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | +-|-|-|-------|-----|---+ +---|-+   +---|-----|-----------------------|---|-------------------------|-----------|---|-|-----------|-|-------|-+ |     |       |     |   |     | | | |   | | 
 | |   | | |   | | |   |   |     |     |   |     |   | |   |       |           | | |   |         | |     |   |   |       |   |   | |           | | | |   |   |     |       |     |   |     | | | |   | | 
 | |   | | |   | | |   |   |     +---+ |   |     |   +-|-----------|-------------|---------------|-|-------------|---------------|-----------+ | | +-+   | +-------|-------------+   |     | | | |   | | 
 | |   | | |   | | |   |   |         | |   |     |     |   |       |           | | |   |         | |     |   |   |       |   |   | |         | | |       | | |     |       |         |     | | | |   | | 
 +-|-----|-|---|-----------|---------|-|---|-----------|---|-------|-------------|---------------|-----+ |   |   |       | +-|-+ | |         | | |       | | |     |       |         |     | | | |   | | 
   |   | | |   | | |   |   |         | |   |     |     |   |       |           | | |   |         | |   | |   |   |       | | | | | |         | | |       | | |     |       |         |     | | | |   | | 
   | +-----|-------|---|---|-----+   | |   |     |   +-|---|---------------------------|-----------+   | |   |   |       | | | | | |         | | |       | | |     |       |         |     | | | |   | | 
   | | | | |   | | |   |   |     |   | |   |     |   | |   |       |           | | |   |         |     | |   |   |       | | | | | |         | | |       | | |     |       |         |     | | | |   | | 
   | | | | |   | | +-------|-----|-----|---|---------|-------------|-----------|-|-|---|---------|-----|---------|---------+ | | | |         | | |       | | +-----------------------------+ | | |   | | 
   | | | | |   | |     |   |     |   | |   |     |   | |   |       |           | | |   |         |     | |   |   |       |   | | | |         | | |       | |       |       |         |       | | |   | | 
   | | | | |   | |     +---|---------|-----|---------+ | +-|--------------T------|-|---|---------|-----+ +-------|-----------|---|-----------|-----------|-+       |       |         |       | | |   | | 
   | | | | |   | |         |     |   | |   |     |     | | |       |           | | |   |         |           |   |       |   | | | |         | | |       |         |       |         |       | | |   | | 
 +-|---|-------|-----------|---------|-----------------|-----------|---------------|---|-------------------------|-------|-----|---|-----------+ |       |         |       |         |       | | |   | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |           | | |   |         |           |   |       |   | | | |         |   |       |         |       |         |       | | |   | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |           +-|-|-------------|-----+     +---|-------+ +-+ | | | +-------|-----------|---------|-------|---------|---------|-+   | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         |         |   | | | |       |   |       |         |       |         |       | |     | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         |         |   | | | |       |   |       |         |       |         |       | |     | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         |         |   | | | |       |   |       |         |       |         |       | |     | | 
 +---------+   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         | +-----------|-------------|-+ |       | +-------|-------|-------------------------|-+ 
   | | | |     | |         |     |   | |   |     |     | | |       |             | |   |         |     |         | |       |   | | | |       | | |       | |       |       |         |       | |     |   
 +-+ | | |     | |         |     |   | |   |     |     | | |       |             | |   |         |     |         +---------|---|---|---------|-|-|-----------------------+ |         +-------|-+     +-+ 
 |   | | |     | |         |     |   | |   |     |     | | |       |             | |   |         |     |           |       |   | | | |       | | |       | |       |     | |                 |         | 
 |   | | |     | |         |     +---+ |   |     |     | +-|---------------------|-|-------------|-----|-----------------------|-----|---------------------|-------+     | |                 |         | 
 |   | | |     | |         |           |   |     |     |   |       |             | |   |         |     |           |       |   | | | |       | | |       | |             | |                 |         | 
 |   | | |     +-|---------|---------------|-----+     |   |       |         +-------------------|-----|-----+     +-------|---|---|-|---------|---------|---------------|-|-+               |         | 
 |   | | |       |         |           |   |           |   |       |         |   | |   |         R     |     |             |   | | | |       | | |       | |             | | |               |         | 
 |   | | |       |         |           |   |     +---------------------------|-----|-------------|-----------|-----------------|-|---|-----------|-------|-----------------|-|---------------|---------+ 
 |   | | |       |         |           |   |     |     |   |       |         |   | |   |         |     |     |             |   | | | |       | | |       | |             | | |               |           
 |   | +-|-------|---------|---------------------------|---|-------|-------------------|---------|-------------------------+   +---|-+   +---|-+ |       | |             | | |               |           
 |   |   |       |         |           |   |     |     |   |       |         |   | |   |         |     |     |                   | |     |   |   |       | |             | | |               |           
 +-------|-------|---------|---------------------------------------|---------|-----|-------------------|-+   |                   | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |   |       |         |   | |   |         |     | |   |                   | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |   +-------------------------------------------|-+   +-----+             | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |           |         |   | |   |         |     |           |             | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |           +-----------------------------+     |           +-------+     +-|---+ |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |                     |   | |   |               |                   |       |   | |   |   |       | |             | | |               |           
     |   +-------|---------|-----------|---------+ +---|---+                 |   | |   |               +-------+           |       | +-------|---+       | |             | | |               |           
     |           |         |           |   |       |   |   |                 |   | |   |                       |           |       | | | |   |           | |             | | |               |           
 +---------------|-------------------------|-------|---|---|---------------------|-|---+                       +-----------|A------------------------------|-----------+ | | |               |           
 |   |           |         |           |   |       |   |   |                 |   | |                                       |       | | | |   |           | |           | | | |               |           
 |   |           |         |           |   |       |   |   |                 |   | |                                       |       | | | |   |           | |           | | | |               |           
 |   |           |         |           |   |       |   |   |                 |   | |                                       |       | | | |   |           | |           | | | |               |           
 |   |           |       +-|-----------------------+   |   +-----------------|---+ +---------------------------------------+       | | +-+   +-------------------------+ | | |               |           
 |   |           |       | |           |   |           |                     |                                                     | |                   | |             | | |               |           
 +---+   +---+   |       | |       +-------------------|---------------------------------------------------------------------------+ |                   | |             | | |               |           
         |   |   |       | |       |   |   |           |                     |                                                       |                   | |             | | |               |           
 +-----------+   |       | |       |   |   |           |                     +-----------------------------------------+             |                   +-|-------------------------------------------+ 
 |       |       |       | |       |   |   |           |                                                               |             |                     |             | | |               |         | 
 +-+     |       +---------|-------+   |   |           +---------------------------------------------------------------+             +-----------------------------------------------------------------+ 
   |     |               | |           |   |                                                                                                               |             | | |               |           
 Q-+     +---------------+ +-----------+   +---------------------------------------------------------------------------------------------------------------+             +-+ +---------------+           
                                                                                                                                                                                                         
";

fn main() {
    let mut diagram : Vec<Vec<char>> = Vec::new();
    let directions = vec!( (-1,0), (1,0), (0,-1), (0,1) );
    
    for line in INPUT.split( '\n' ) {
        diagram.push( line.chars().collect() );
    }
    let mut x : i32;
    let mut y : i32 = 0;
    let mut dx : i32 = 0;
    let mut dy : i32 = 1;
    let mut visited : Vec<char> = Vec::new();
    let mut num_steps = 1;  // Count initial '|'
    
    x = diagram[0].iter().position( |&i| i == '|' ).unwrap() as i32;
    println!( "Start position: {},{}", x, y );

    loop {
        x += dx;
        y += dy;
        num_steps += 1;
        match diagram[y as usize][x as usize] {
            '|' => {
                // No change
            }
            '-' => {
                // No change
            }
            '+' => {
                // Corner
                let new_dir = directions.iter().filter( |t| {
                    let (px, py) = **t;
                    let nx = x + px;
                    let ny = y + py;
                    let last_x = x - dx;
                    let last_y = y - dy;
                    // Don't go off the edge
                    ( ny >= 0 && ny < diagram.len() as i32 ) &&
                        ( nx >= 0 && nx < diagram[ny as usize].len() as i32 ) &&
                        // Don't reverse direction
                        ( nx != last_x || ny != last_y ) &&
                        // Follow the path (which could be a letter, or another +)
                        diagram[ny as usize][nx as usize] != ' '
                } ).nth( 0 ).unwrap();
                // A pair is not an lvalue in Rust, alas.
                dx = new_dir.0;                
                dy = new_dir.1;
            }
            ' ' => {
                // Oops, this wasn't a step.
                num_steps -= 1;
                break;
            }
            c => {
                visited.push( c );
            }
        }
        println!( "{},{} visited {} direction {},{}",
                         x, y,
                         diagram[y as usize][x as usize],
                         dx, dy );
    }    
    println!( "Visited: {}", visited.iter().collect::<String>() );
    println!( "Steps: {}", num_steps );
}
